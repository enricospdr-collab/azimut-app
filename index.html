<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Azimut Multi-Point Tool</title>

<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body { margin:0; font-family: Arial; }
#map { height:60vh; }
#panel { height:40vh; padding:10px; background:#f2f2f2; overflow:auto; }
input, select, button { padding:4px; margin:2px; }
.result-item { padding:5px; cursor:pointer; border-bottom:1px solid #ccc; }
.result-item:hover { background:#ddd; }
.address-label { font-size:12px; background:white; padding:4px; border:1px solid black; }

#elevationInfo { margin-top:6px; font-size:14px; }

/* profilo altimetrico: minimale, senza cambiare l'interfaccia */
#profileWrap {
  margin-top: 8px;
  background: #fff;
  border: 1px solid #ddd;
  padding: 6px;
}
#elevationChart {
  width: 100%;
  height: 180px;           /* ottimo su smartphone */
  display: block;
}
</style>

<!-- Librerie PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Chart.js per profilo altimetrico -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- MODALE DI BENVENUTO -->
<div id="welcomeModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
background: rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
  <div style="background:white; padding:20px; border-radius:8px; max-width:500px; width:90%; position:relative;">
    <span id="closeModal" style="position:absolute; top:10px; right:15px; cursor:pointer; font-weight:bold; font-size:18px;">&times;</span>
    <h2>Benvenuti all'Azimut Multi-Point Tool – Versione di prova</h2>
    <p>Questa applicazione è destinata ad uso <b>ludico e formativo</b> per tutti i partecipanti del <b>Corso CAI Scialpinismo Vicenza 2026</b>.</p>
    <p>Siete incoraggiati a esplorare le funzionalità e a fornire <b>suggerimenti</b>.</p>
    <p><i>Grazie e buon divertimento!</i><br>– <b>Enrico Spadaro</b></p>
  </div>
</div>

<div id="map"></div>

<div id="panel">

  <h3>Ricerca località</h3>
  <input type="text" id="searchInput" placeholder="Es. Vicenza, Via Roma 10 Milano">
  <button onclick="goToMyLocation()">Vai alla mia posizione</button>
  <div id="searchResults"></div>

  <hr>

  <input type="checkbox" id="lockPoints"> Blocca marker

  Declinazione magnetica (°):
  <input type="number" id="decl" value="0" step="0.1">

  <br><br>
  <button onclick="resetAll()">Reset completo</button>
  <button onclick="exportCSV()">Esporta CSV</button>
  <button onclick="exportMapPDF()">Esporta mappa in PDF</button>

  <div id="results"></div>

  <!-- DATI ALTIMETRICI -->
  <div id="elevationInfo">
    Dislivello positivo: <span id="gain">0</span> m |
    Dislivello negativo: <span id="loss">0</span> m |
    Quota minima: <span id="minAlt">0</span> m |
    Quota massima: <span id="maxAlt">0</span> m
    <span id="badge-pendenza" style="margin-left:8px;"></span>
  </div>

  <!-- PROFILO ALTIMETRICO (minimale) -->
  <div id="profileWrap">
    <canvas id="elevationChart"></canvas>
  </div>

</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Logica app -->
<script src="app.js"></script>

<script>
window.addEventListener('load', function() {
  const modal = document.getElementById('welcomeModal');
  const closeBtn = document.getElementById('closeModal');

  modal.style.display = 'flex';
  closeBtn.addEventListener('click', () => modal.style.display='none');
  modal.addEventListener('click', function(e){
    if(e.target===modal) modal.style.display='none';
  });
});
</script>

</body>
</html>